\chapter{Appendices}

\section{Life quality as walkability}

\subsection{Secondary data sources}
\label{SI:walkabilityData}
\begin{itemize}
  \item {Sport associations in Budapest}~\cite{HU_sport}
  \item {Kindergartens, daycares, primary and secondary education}~\cite{HU_Edu}
  \item {Art and music schools}~\cite{HU_Art}
  \item {Child health services}~\cite{HU_Child}
  \item {Social welfare system (eg.: elderly care)}~\cite{HU_Social}
  \item {Culture centers}~\cite{HU_Cult}
  \item {Indoor playgrounds}~\cite{HU_Play}
  \item {Healthcare (hospitals, private and public clinics, specialists)}~\cite{HU_Health}
  \item {Fitness and training facilities}~\cite{HU_Fitness}
  \item {Outdoor fitness facilities}~\cite{HU_outfitness}
  \item {Thermal baths and spa}~\cite{HU_Thermal}
  \item {Playgrounds and parks}~\cite{HU_Park}
\end{itemize}

\subsection{Weights used in the calculations}
The weights of the different $Q$ indices in the final aggregation as well as in sub-categories highly depends on the context and the nature of the problem. Here we present the values we used to generate the results of this study, that were agreed upon consulting with experts.

The weights of the sub-indices from equation (\ref{final_Q}) are of the following values:
\begin{itemize}
  \item $w^{\text{services}}=0.7$;
  \item $w^{\text{safety}}=0.1$;
  \item $w^{\text{environment}}=0.2$
\end{itemize}

The category weights used in equation (\ref{Q_services}), aggregating $Q^{services}$ are:

\begin{itemize}
  \item $w^{\text{family}}= 0.3$;
  \item $w^{\text{health}}= 0.3$;
  \item $w^{\text{culture}} = 0.15$;
  \item $w^{\text{sport}} = 0.15$;
  \item $w^{\text{night life}}=0.1$
\end{itemize}

\section{Data-driven strategies for optimal bicycle network growth}
\subsection{Data}
Table~\ref{tab:DataDrivenCities} shows measures for the fifteen analyzed cities. For each layer in a city we report the number of nodes $N$ and the number of connected components $CC$.
\begin{table*}[ht!]
  \centering
  \begin{adjustbox}{width=0.9\textwidth,keepaspectratio}
    \begin{tabular}{llllllllllllll}
      \toprule
      {}         & \multicolumn{3}{l}{walk} & \multicolumn{3}{l}{bike} & \multicolumn{3}{l}{rail} & \multicolumn{3}{l}{drive} & Population                                                                                                             \\
      {}         & $N$                      & $CC$                     & $\ell(km)$               & $N$                       & $CC$       & $\ell(km)$ & $N$     & $CC$ & $\ell(km)$ & $N$       & $CC$ & \multicolumn{2}{l}{$\ell(km)$}              \\
      \midrule
      Amsterdam  & 23,321.0                 & 1.0                      & 2,075.67                 & 34,529.0                  & 355.0      & 972.08     & 1,096.0 & 8.0  & 288.72     & 15,125.0  & 1.0  & 2,010.49                       & 872,680    \\
      Barcelona  & 20,203.0                 & 1.0                      & 2,122.6                  & 7,553.0                   & 122.0      & 229.19     & 263.0   & 29.0 & 105.98     & 10,393.0  & 1.0  & 1,551.44                       & 1,600,000  \\
      Bogota     & 81,814.0                 & 1.0                      & 8,686.51                 & 9,760.0                   & 171.0      & 367.33     & 166.0   & 12.0 & 20.2       & 62,017.0  & 1.0  & 7,383.69                       & 7,412,566  \\
      Budapest   & 73,172.0                 & 1.0                      & 7,746.12                 & 10,494.0                  & 257.0      & 336.13     & 1,588.0 & 20.0 & 522.06     & 37,012.0  & 1.0  & 5,332.97                       & 1,752,286  \\
      Copenhagen & 30,746.0                 & 1.0                      & 2,286.66                 & 13,980.0                  & 321.0      & 417.01     & 276.0   & 3.0  & 123.56     & 15,822.0  & 1.0  & 1,547.3                        & 2,557,737  \\
      Detroit    & 47,828.0                 & 1.0                      & 6,769.46                 & 3,663.0                   & 53.0       & 141.06     & 20.0    & 3.0  & 11.54      & 28,462.0  & 1.0  & 5,624.49                       & 672,662    \\
      Jakarta    & 140,042.0                & 1.0                      & 13,947.96                & 248.0                     & 19.0       & 8.44       & 60.0    & 8.0  & 81.24      & 138,388.0 & 1.0  & 14,194.2                       & 10,075,310 \\
      LA         & 89,543.0                 & 1.0                      & 14,329.92                & 14,577.0                  & 230.0      & 653.16     & 173.0   & 9.0  & 90.82      & 71,091.0  & 1.0  & 13,324.46                      & 3,792,621  \\
      London     & 270,659.0                & 1.0                      & 23,846.62                & 62,398.0                  & 3,023.0    & 1,281.71   & 2,988.0 & 38.0 & 1,045.39   & 179,782.0 & 1.0  & 18,154.52                      & 8,908,081  \\
      Manhattan  & 13,326.0                 & 1.0                      & 1,320.78                 & 3,871.0                   & 105.0      & 111.42     & 349.0   & 5.0  & 197.51     & 5,671.0   & 1.0  & 1,022.13                       & 1,628,701  \\
      Mexico     & 108,033.0                & 1.0                      & 14,547.18                & 5,218.0                   & 52.0       & 332.37     & 371.0   & 18.0 & 253.48     & 95,375.0  & 1.0  & 13,732.39                      & 8,918,653  \\
      Phoenix    & 111,363.0                & 1.0                      & 14,314.0                 & 35,631.0                  & 141.0      & 1,221.18   & 105.0   & 4.0  & 71.64      & 73,688.0  & 1.0  & 11,841.49                      & 1,445,632  \\
      Portland   & 50,878.0                 & 1.0                      & 5,324.78                 & 24,252.0                  & 198.0      & 596.36     & 230.0   & 2.0  & 132.36     & 35,025.0  & 1.0  & 4,583.47                       & 583,776    \\
      Singapore  & 82,808.0                 & 1.0                      & 8,633.13                 & 12,981.0                  & 104.0      & 339.39     & 683.0   & 14.0 & 428.66     & 50,403.0  & 1.0  & 6,635.37                       & 5,638,700  \\
      \bottomrule
    \end{tabular}
  \end{adjustbox}
  \caption{Measures for the administrative area of analyzed cities. The number of connected components ($CC$) and nodes ($N$) for each layer in all cities of our dataset are highly diverse due to the varying developmental levels and focus of transport.
    \label{tab:DataDrivenCities}}
\end{table*}

Figure \ref{fig:Nodes} shows the connected component size distribution $P(N_{cc})$ for all considered layers and cities.

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/Nodes_cc.png}
  \caption[Connected component size distribution for analyzed cities]{The connected component size distribution [$P(N_{cc})$] for all cities and layers is well connected except in the bicycle layer. London has the most fragmented bicycle infrastructure layer, with more than 3000 components}
  \label{fig:Nodes}
\end{figure*}


\subsection{Algorithms}
We develop two main algorithms to improve the bicycle layer. The first algorithm, \textit{Largest-to-Second}, identifies in each step the largest connected component and connects it to the second largest. The second algorithm, \textit{Largest-to-Closest}, also identifies the largest connected component, but in each step connects it to the closest of the remaining components.

To evaluate our algorithms we test them against a random baseline, \textit{Random-to-Closest}. In each step, \textit{Random-to-Closest} picks a component at random and connects it to the closest of the remaining components. We implement another baseline, the extreme case of \textit{Closest-Components}, which prioritizes connecting the closest two components.

\begin{algorithm}[h!]
  \caption{Largest-to-Second}\label{greedy_lcc}
  \begin{algorithmic}[1]
    \Procedure{\textit{L2S}}{}
    \State $\textit{G} \gets \text{ bicycle network graph}$
    \State $\textit{wcc} \gets \text{ components of network G}$
    \For {i in length(wcc)-1}
    \State  \text{sort \textit{wcc} by components size}
    \State $\textit{cc} \gets \text{ two biggest components from \textit{wcc}}$
    \State $\textit{i\_j} \gets \text{ closest nodes between } cc_0 \text{ and } cc_1$
    \State $\text{connect } cc_0 \text{ and } cc_1 \text{ in } i\_j$
    \EndFor
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[h!]
  \caption{Largest-to-Closest}\label{greedy_min}
  \begin{algorithmic}[1]
    \Procedure{\textit{L2C}}{}
    \State $\textit{G} \gets \text{ bicycle network graph}$
    \State $\textit{wcc} \gets \text{ components of network G}$
    \For {i in length(wcc)-1}
    \State  \text{sort \textit{wcc} by components size}
    \State $cc_0 \gets \text{ biggest component from \textit{wcc}}$
    \State $cc_n \gets \text{ clossest component to } cc_0$
    \State $\textit{i\_j} \gets \text{ closest nodes between } cc_0 \text{ and } cc_n$
    \State $\text{connect } cc_0 \text{ and } cc_n \text{ in } i\_j$
    \EndFor
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[h!]
  \caption{Random-to-Closest}\label{random}
  \begin{algorithmic}[1]
    \Procedure{\textit{R2C}}{}
    \State $\textit{G} \gets \text{ bicycle network graph}$
    \State $\textit{wcc} \gets \text{ components of network G}$
    \For {i in length(wcc)-1}
    \State $cc_{ran} \gets \text{ random component from \textit{wcc}}$
    \State $cc_n \gets \text{ clossest component to } cc_{ran}$
    \State $\textit{i\_j} \gets \text{ closest nodes between } cc_{ran} \text{ and } cc_n$
    \State $\text{connect } cc_{ran} \text{ and } cc_n \text{ in } i\_j$
    \EndFor
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\begin{algorithm}[h!]
  \caption{Closest-Components}\label{min_delta}
  \begin{algorithmic}[1]
    \Procedure{\textit{CC}}{}
    \State $\textit{G} \gets \text{ bicycle network graph}$
    \State $\textit{wcc} \gets \text{ components of network G}$
    \For {i in length(wcc)-1}
    \State $\Delta_{min} \gets \text{ clossest components in \textit{wcc}}$
    \State $cc_{0} \gets \text{ first component for }\Delta_{min}$
    \State $cc_{1} \gets \text{ second component for } \Delta_{min}$
    \State $\textit{i\_j} \gets \text{ closest nodes between } cc_{0} \text{ and } cc_{1}$
    \State $\text{connect } cc_{0} \text{ and } cc_{1} \text{ in } i\_j$
    \EndFor
    \EndProcedure
  \end{algorithmic}
\end{algorithm}

\subsection{Bicycle network improvement}

Here we show the improvement of the bicycle network after the implementation of the algorithms. We measure the improvement with four different metrics. Two of them implement the notion of connectedness: i) Fraction of nodes inside the largest connected component compared to the total number of nodes in the bicycle layer, and ii) the fraction of link kilometers inside the largest connected component. In Figure \ref{fig:NodesIncrease} and \ref{fig:Lengthsncrease} we show these two measures for fourteen different cities. We also quantify iii) bicycle-to-car directness to answer the question ``how direct are the average routes of bicycles compared to cars?''. Finally, in order to measure the cumulative efficiency of our algorithms, we define the metric: iv) $G_{LCC}$ as the relative gain of bicycle path kilometers in the largest connected component. In Figures \ref{fig:Directness} and \ref{fig:Gain} we report these two measures for all algorithms and cities considered.

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Nodes.png}
  \caption{Normalized increase in nodes inside the largest connected component ($n_{LCC}$).}
  \label{fig:NodesIncrease}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Lengths.png}
  \caption{Normalized increase in kilometers inside the largest connected component ($\ell_{LCC}$).}
  \label{fig:Lengthsncrease}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Lengths_Bike-Streets_FractionKM.pdf}
  \caption{Normalized increase in kilometers inside the largest connected component ($\ell_{LCC}$) versus the fraction of extant kilometers to be added.}
  \label{fig:Lengthsncrease_norm}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Directness.png}
  \caption{Bike-car directness $\Delta$ per invested kilometers.}
  \label{fig:Directness}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Gain.png}
  \caption{Kilometers gain in the largest connected component.}
  \label{fig:Gain}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/Reviewer_Coverage.png}
  \caption{Area of influence (coverage) for the bicycle infrastructure in the street layer.}
  \label{fig:Coverage}
\end{figure*}

\section*{Bicycle network and 30 km/hr streets}
We applied the algorithms to the bicycle infrastructure and all the bikeable streets, those with a speed limit of $30\ km/hr$ or less (see Figures~\ref{fig:NodesIncrease_BikeStreets}, \ref{fig:Lengthsncrease_BikeStreets}, \ref{fig:Directness_BikeStreets}, and \ref{fig:Gain_BikeStreets}).

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Nodes_Bike_Streets.png}
  \caption{Normalized increase in nodes inside the largest connected component ($n_{LCC}$).}
  \label{fig:NodesIncrease_BikeStreets}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Lengths_Bike_Streets.png}
  \caption{Normalized increase in kilometers inside the largest connected component ($\ell_{LCC}$).}
  \label{fig:Lengthsncrease_BikeStreets}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Directness_Bike_Streets.png}
  \caption{Bike-car directness $\Delta$ per invested kilometers.}
  \label{fig:Directness_BikeStreets}
\end{figure*}

\begin{figure*}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{images/datadriven/SI_Gain_Bike_Streets.png}
  \caption{Kilometers gain in the largest connected component.}
  \label{fig:Gain_BikeStreets}
\end{figure*}